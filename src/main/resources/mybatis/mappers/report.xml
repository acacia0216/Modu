<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">

<mapper namespace="report">

    <select id="getCategoryList" parameterType="int" resultType="int">
        select CATEGORYNO
        from CATEGORY_TBL
        where GROUPNO=#{groupNo}
    </select>

    <select id="getMonthlyAnnualList" parameterType="Map" resultType="com.modu.vo.ReportVo">
select CategoryNo,CategoryName,totalIncome,totalSpend,monthNo
from (select sum(accountbookSpend) totalSpend , sum(accountbookIncome) totalIncome , CategoryNo, to_char(min(accountbookRegDate),'MM') monthNo
      from accountbook_tbl
      join category_tbl using (CategoryNo)
      where category_tbl.groupNo=#{groupNo} and accountbookRegDate between #{startDay} and #{lastDay} and CategoryNo=#{categoryNo}
      group by CategoryNo)
            join category_tbl using (CategoryNo)
    </select>

    <select id="getCategoryName" parameterType="int" resultType="String">
        select CATEGORYNAME from CATEGORY_TBL where CATEGORYNO=#{cateNo}
    </select>

    <select id="getAnnualSum" parameterType="map" resultType="String">
        select to_char(sum(accountbookIncome)-sum(accountbookSpend),'999,999,999')
        from accountbook_tbl
        where groupNo=#{groupNo} and accountbookRegDate between #{startDay} and #{lastDay}
    </select>

    <select id="getMonthlySpend" parameterType="map" resultType="String">
        select sum(ACCOUNTBOOKSPEND)
from accountbook_tbl
where groupNo=#{groupNo} and accountbookRegDate between #{startDay} and #{lastDay}
    </select>

    <select id="getMonthlyIncome" parameterType="map" resultType="String">
        select sum(ACCOUNTBOOKINCOME)
from accountbook_tbl
where groupNo=#{groupNo} and accountbookRegDate between #{startDay} and #{lastDay}
    </select>

    <select id="getRecentEvent" parameterType="String" resultType="int">
select TAGNO
from (select ROWNUM rnum, TAGNO, tagDate
from (select tagDate, TAGNO
from (select *
from accountbook_tbl join accountbook_tag_tbl using (accountbookNo)
where groupNo = #{groupNo})tmp join tag_tbl using (tagNo)
order by tagDate desc))
where rnum = 1
 </select>

    <select id="totalSpendByTag" parameterType="map" resultType="com.modu.vo.ReportVo">

    </select>



</mapper>